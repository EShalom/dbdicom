
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "generated\examples\transform\plot_rotate_and_translate.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_generated_examples_transform_plot_rotate_and_translate.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_generated_examples_transform_plot_rotate_and_translate.py:


====================
Rotate and translate
====================

Rotating and translating a 3D volume.

This example illustrates the use of the function `.rotate()` from the dbdicom extension :ref:`extension-vreg`. We use an ellipsoid digital reference object as test data and `.plot_surface()` from extension :ref:`extension-matplotlib` to visualise the results.

.. GENERATED FROM PYTHON SOURCE LINES 10-19

.. code-block:: default

    import numpy as np

    from dbdicom.dro import double_ellipsoid
    from dbdicom.extensions.vreg import rotate
    from dbdicom.extensions.matplotlib import plot_surface, plot_mosaic

    # Choose image 1 as a thumbnail for the gallery
    # sphinx_gallery_thumbnail_number = 2








.. GENERATED FROM PYTHON SOURCE LINES 20-21

Generate and display an ellipsoid test object

.. GENERATED FROM PYTHON SOURCE LINES 21-25

.. code-block:: default


    ellipsoid_orig = double_ellipsoid(12, 40, 32, spacing=(2,3,1), levelset=True)
    plot_surface(ellipsoid_orig)




.. image-sg:: /generated/examples/transform/images/sphx_glr_plot_rotate_and_translate_001.png
   :alt: plot rotate and translate
   :srcset: /generated/examples/transform/images/sphx_glr_plot_rotate_and_translate_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 26-27

Define a rotation vector, apply it and display the result again.

.. GENERATED FROM PYTHON SOURCE LINES 27-37

.. code-block:: default


    # Define an anticlockwise rotation of 30 degrees around the y-axis
    rotation = -30*(np.pi/180)*np.array([0,1,0])

    # Perform the rotation and return a rotated series
    ellipsoid_rot = rotate(ellipsoid_orig, rotation, reshape=True, mode='nearest')

    # Display the surface of the rotated shape
    plot_surface(ellipsoid_rot)



.. rst-class:: sphx-glr-script-out

.. code-block:: pytb

    Traceback (most recent call last):
      File "C:\Users\steve\Dropbox\Software\QIB-Sheffield\dbdicom\docs\examples\transform\plot_rotate_and_translate.py", line 32, in <module>
        ellipsoid_rot = rotate(ellipsoid_orig, rotation, reshape=True, mode='nearest')
      File "C:\Users\steve\Dropbox\Software\QIB-Sheffield\dbdicom\src\dbdicom\extensions\vreg.py", line 656, in rotate
        output_series.set_pixel_values(output_array, coords={'SliceLocation': np.arange(output_array.shape[-1])})
      File "C:\Users\steve\Dropbox\Software\QIB-Sheffield\dbdicom\src\dbdicom\types\series.py", line 1150, in set_pixel_values
        raise ValueError(msg)
    ValueError: Cannot set values to an empty series. Use Series.expand() to create empty frames first, or set the loc keyword to define coordinates for the new frames.




.. GENERATED FROM PYTHON SOURCE LINES 38-39

Display the rotated shape as a mosaic

.. GENERATED FROM PYTHON SOURCE LINES 39-42

.. code-block:: default


    plot_mosaic(ellipsoid_rot) 


.. GENERATED FROM PYTHON SOURCE LINES 43-44

When applying the rotation we used the `mode='nearest'` so that the values outside the boundaries of the volume are filled by nearest neighbour sampling. The default setting would fill these with a `constant=0` value, producing an additional surface at the edge of the volume:

.. GENERATED FROM PYTHON SOURCE LINES 44-49

.. code-block:: default


    ellipsoid_rot = rotate(ellipsoid_orig, rotation, reshape=True)
    plot_surface(ellipsoid_rot)



.. GENERATED FROM PYTHON SOURCE LINES 50-51

We used `reshape=True` so the new volume would encompass the entire shape. Running this with the default setting of `reshape=False` retains the original image shape and therefore misses part of the rotated volume:

.. GENERATED FROM PYTHON SOURCE LINES 51-53

.. code-block:: default


    ellipsoid_rot = rotate(ellipsoid_orig, rotation, reshape=False, mode='nearest')
    plot_surface(ellipsoid_rot)

.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  3.280 seconds)


.. _sphx_glr_download_generated_examples_transform_plot_rotate_and_translate.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/QIB-Sheffield/dbdicom/main?urlpath=lab/tree/notebooks/generated/examples/transform/plot_rotate_and_translate.ipynb
        :alt: Launch binder
        :width: 150 px



    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_rotate_and_translate.py <plot_rotate_and_translate.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_rotate_and_translate.ipynb <plot_rotate_and_translate.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
